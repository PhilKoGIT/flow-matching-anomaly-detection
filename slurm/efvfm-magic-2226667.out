== Job start ==
================================================================================
LOADING & PREPARING BUSINESS TRANSACTION DATA
================================================================================
✓ Original data saved to data/original_data.csv
✓ Index mappings saved to data/train_mapping.csv and data/test_mapping.csv
✓ Feature columns saved to data/feature_columns.json

Shapes nach Preprocessing:
  X_train: (30940, 13)
  X_test : (7736, 13)
  y_train: (30940,), Anomalien = 34 (0.11%)
  y_test : (7736,), Anomalien = 6 (0.08%)

Features, die ins Modell gehen:
['amount', 'amount_mean_5', 'amount_std_5', 'amount_change', 'time_since_last_tx', 'day_of_month', 'median_day_of_month_per_series', 'dom_deviation', 'partner_tx_count', 'is_first_tx', 'day_of_week', 'valid_ref']

Feature matrix shapes (nach Drop von bank_account_uuid):
  X_train: (30940, 12)
  X_test : (7736, 12)

Test-Label-Verteilung (0=normal, 1=anomaly):
  Normal : 7730 (99.92%)
  Anomaly: 6 (0.08%)

================================================================================
TRAINING FORESTDIFFUSION MODEL AUF GESAMTEN TRAININGSDATEN
================================================================================
✓ Model trained successfully on full training data!

================================================================================
COMPUTING ANOMALY SCORES AUF TESTSET
================================================================================
✓ Anomaly scores computed: 7736
  Score range: [2.2105, 44.8858]
  Score mean : 5.2169
  Score std  : 2.5513

================================================================================
EVALUATION METRICS
================================================================================

✓ ROC-AUC Score: 0.9772

Performance at different threshold percentiles:
--------------------------------------------------------------------------------

90th Percentile (threshold=7.7646):
  Precision: 0.0078 | Recall: 1.0000 | F1: 0.0154 | Acc: 0.9007
  Confusion Matrix: TP=6, FP=768, TN=6962, FN=0

95th Percentile (threshold=9.1122):
  Precision: 0.0129 | Recall: 0.8333 | F1: 0.0254 | Acc: 0.9505
  Confusion Matrix: TP=5, FP=382, TN=7348, FN=1

97.5th Percentile (threshold=11.0068):
  Precision: 0.0206 | Recall: 0.6667 | F1: 0.0400 | Acc: 0.9752
  Confusion Matrix: TP=4, FP=190, TN=7540, FN=2

99th Percentile (threshold=15.5210):
  Precision: 0.0256 | Recall: 0.3333 | F1: 0.0476 | Acc: 0.9897
  Confusion Matrix: TP=2, FP=76, TN=7654, FN=4

✓ Best F1-Score: 0.0476 at 99th percentile (threshold=15.5210)

Final confusion matrix at best F1 threshold:
[[7654   76]
 [   4    2]]
  Normal correctly classified: 7654/7730
  Anomalies detected          : 2/6

================================================================================
CREATING VISUALIZATIONS
================================================================================
✓ Saved plot to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_detection_results.png

================================================================================
SAVING RESULTS
================================================================================

Top 20 highest anomaly scores:
      test_index  ...                                anomaly_description
7322        7322  ...                                                NaN
7071        7071  ...                                                NaN
7541        7541  ...                                                NaN
6562        6562  ...                                                NaN
6807        6807  ...                                                NaN
4358        4358  ...                                                NaN
5684        5684  ...                                                NaN
3025        3025  ...                                                NaN
3572        3572  ...                                                NaN
5882        5882  ...                                                NaN
3309        3309  ...                                                NaN
5685        5685  ...                                                NaN
3841        3841  ...                                                NaN
2485        2485  ...                                                NaN
4103        4103  ...                                                NaN
4653        4653  ...                                                NaN
5170        5170  ...                                                NaN
1967        1967  ...                                                NaN
4613        4613  ...  IBAN_MISMATCH_ANOMALY: IBAN changed from GB27E...
864          864  ...                                                NaN

[20 rows x 6 columns]

✓ Results saved to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_scores.csv
✓ Summary saved to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_summary.json

================================================================================
BUSINESS ANOMALY DETECTION EXPERIMENT COMPLETED!
================================================================================
ROC-AUC: 0.9772
Best F1: 0.0476
Normal correctly classified: 7654/7730
Anomalies detected         : 2/6

Used Hyperparameters:
n_t: 100
duplicate_K: 20
diffusion_type: 'flow'
max_depth: 8
n_estimators: 150
eta: 0.3
dataset: Business Transaction Data
datset size (train/test): 30940/7736
== Job abgeschlossen ==

============================= JOB FEEDBACK =============================

NodeName=uc2n911
Job ID: 2226667
Cluster: uc3
User/Group: ma_pkonz/ma_ma
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 2
CPU Utilized: 04:30:10
CPU Efficiency: 89.99% of 05:00:14 core-walltime
Job Wall-clock time: 02:30:07
Memory Utilized: 11.58 GB
Memory Efficiency: 36.18% of 32.00 GB (32.00 GB/node)
