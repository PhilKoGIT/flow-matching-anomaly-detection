== Job start ==
================================================================================
LOADING & PREPARING BUSINESS TRANSACTION DATA
================================================================================
✓ Original data saved to data/original_data.csv
✓ Index mappings saved to data/train_mapping.csv and data/test_mapping.csv
✓ Feature columns saved to data/feature_columns.json
✓ preprocessed_full_dataset.csv saved to data/

Shapes nach Preprocessing:
  X_train: (24755, 8)
  X_test : (6189, 8)
  y_train: (24755,), Anomalien = 43 (0.17%)
  y_test : (6189,), Anomalien = 11 (0.18%)

Features, die ins Modell gehen:
['amount', 'amount_mean_5', 'amount_change', 'time_since_last_tx', 'partner_tx_count', 'is_first_tx', 'valid_ref']

Feature matrix shapes (nach Drop von bank_account_uuid):
  X_train: (24755, 7)
  X_test : (6189, 7)

Test-Label-Verteilung (0=normal, 1=anomaly):
  Normal : 6178 (99.82%)
  Anomaly: 11 (0.18%)

================================================================================
TRAINING FORESTDIFFUSION MODEL AUF GESAMTEN TRAININGSDATEN
================================================================================
✓ Model trained successfully on full training data!

================================================================================
COMPUTING ANOMALY SCORES AUF TESTSET
================================================================================
✓ Anomaly scores computed: 6189
  Score range: [1.7588, 29.5459]
  Score mean : 4.2069
  Score std  : 1.7841

================================================================================
EVALUATION METRICS
================================================================================

✓ ROC-AUC Score: 0.8305

Performance at different threshold percentiles:
--------------------------------------------------------------------------------

90th Percentile (threshold=5.4242):
  Precision: 0.0113 | Recall: 0.6364 | F1: 0.0222 | Acc: 0.9005
  Confusion Matrix: TP=7, FP=612, TN=5566, FN=4

95th Percentile (threshold=6.1735):
  Precision: 0.0226 | Recall: 0.6364 | F1: 0.0436 | Acc: 0.9504
  Confusion Matrix: TP=7, FP=303, TN=5875, FN=4

97.5th Percentile (threshold=8.6050):
  Precision: 0.0452 | Recall: 0.6364 | F1: 0.0843 | Acc: 0.9754
  Confusion Matrix: TP=7, FP=148, TN=6030, FN=4

99th Percentile (threshold=11.5789):
  Precision: 0.0968 | Recall: 0.5455 | F1: 0.1644 | Acc: 0.9901
  Confusion Matrix: TP=6, FP=56, TN=6122, FN=5

✓ Best F1-Score: 0.1644 at 99th percentile (threshold=11.5789)

Final confusion matrix at best F1 threshold:
[[6122   56]
 [   5    6]]
  Normal correctly classified: 6122/6178
  Anomalies detected          : 6/11

================================================================================
CREATING VISUALIZATIONS
================================================================================
✓ Saved plot to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_detection_results.png

================================================================================
SAVING RESULTS
================================================================================

Top 20 highest anomaly scores:
      test_index  ...                                anomaly_description
4983        4983  ...                                                NaN
5776        5776  ...                                                NaN
4021        4021  ...                                                NaN
5758        5758  ...        AMOUNT_ANOMALY: Amount changed from ~708309
4656        4656  ...                                                NaN
5919        5919  ...                                                NaN
3763        3763  ...                                                NaN
5757        5757  ...  IBAN_MISMATCH_ANOMALY: IBAN changed from GB17P...
1788        1788  ...                                                NaN
2891        2891  ...                                                NaN
4358        4358  ...                                                NaN
1648        1648  ...                                                NaN
1214        1214  ...                                                NaN
1368        1368  ...                                                NaN
2885        2885  ...                                                NaN
4136        4136  ...                                                NaN
6043        6043  ...                                                NaN
617          617  ...                                                NaN
3886        3886  ...                                                NaN
5306        5306  ...                                                NaN

[20 rows x 6 columns]

✓ Results saved to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_scores.csv
✓ Summary saved to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_summary.json

================================================================================
BUSINESS ANOMALY DETECTION EXPERIMENT COMPLETED!
================================================================================
ROC-AUC: 0.8305
Best F1: 0.1644
Normal correctly classified: 6122/6178
Anomalies detected         : 6/11

Used Hyperparameters:
n_t: 100
duplicate_K: 20
diffusion_type: 'flow'
max_depth: 8
n_estimators: 150
eta: 0.3
dataset: Business Transaction Data
datset size (train/test): 24755/6189
== Job abgeschlossen ==

============================= JOB FEEDBACK =============================

NodeName=uc2n913
Job ID: 2229400
Cluster: uc3
User/Group: ma_pkonz/ma_ma
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 2
CPU Utilized: 01:48:36
CPU Efficiency: 87.56% of 02:04:02 core-walltime
Job Wall-clock time: 01:02:01
Memory Utilized: 6.02 GB
Memory Efficiency: 18.82% of 32.00 GB (32.00 GB/node)
