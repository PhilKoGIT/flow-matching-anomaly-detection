== Job start ==
================================================================================
LOADING & PREPARING BUSINESS TRANSACTION DATA
================================================================================
✓ Original data saved to data/original_data.csv
✓ Index mappings saved to data/train_mapping.csv and data/test_mapping.csv
✓ Feature columns saved to data/feature_columns.json
✓ preprocessed_full_dataset.csv saved to data/

Shapes nach Preprocessing:
  X_train: (4019, 8)
  X_test : (1005, 8)
  y_train: (4019,), Anomalien = 15 (0.37%)
  y_test : (1005,), Anomalien = 2 (0.20%)

Features, die ins Modell gehen:
['amount', 'amount_mean_5', 'amount_change', 'time_since_last_tx', 'partner_tx_count', 'is_first_tx', 'valid_ref']

Feature matrix shapes (nach Drop von bank_account_uuid):
  X_train: (4019, 7)
  X_test : (1005, 7)

Test-Label-Verteilung (0=normal, 1=anomaly):
  Normal : 1003 (99.80%)
  Anomaly: 2 (0.20%)

================================================================================
TRAINING FORESTDIFFUSION MODEL AUF GESAMTEN TRAININGSDATEN
================================================================================
✓ Model trained successfully on full training data!

================================================================================
COMPUTING ANOMALY SCORES AUF TESTSET
================================================================================
✓ Anomaly scores computed: 1005
  Score range: [2.2560, 22.1719]
  Score mean : 4.9149
  Score std  : 1.8844

================================================================================
EVALUATION METRICS
================================================================================

✓ ROC-AUC Score: 0.9995

Performance at different threshold percentiles:
--------------------------------------------------------------------------------

90th Percentile (threshold=6.6791):
  Precision: 0.0198 | Recall: 1.0000 | F1: 0.0388 | Acc: 0.9015
  Confusion Matrix: TP=2, FP=99, TN=904, FN=0

95th Percentile (threshold=8.3520):
  Precision: 0.0392 | Recall: 1.0000 | F1: 0.0755 | Acc: 0.9512
  Confusion Matrix: TP=2, FP=49, TN=954, FN=0

97.5th Percentile (threshold=9.6208):
  Precision: 0.0769 | Recall: 1.0000 | F1: 0.1429 | Acc: 0.9761
  Confusion Matrix: TP=2, FP=24, TN=979, FN=0

99th Percentile (threshold=11.7032):
  Precision: 0.1818 | Recall: 1.0000 | F1: 0.3077 | Acc: 0.9910
  Confusion Matrix: TP=2, FP=9, TN=994, FN=0

✓ Best F1-Score: 0.3077 at 99th percentile (threshold=11.7032)

Final confusion matrix at best F1 threshold:
[[994   9]
 [  0   2]]
  Normal correctly classified: 994/1003
  Anomalies detected          : 2/2

================================================================================
CREATING VISUALIZATIONS
================================================================================
✓ Saved plot to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_detection_results.png

================================================================================
SAVING RESULTS
================================================================================

Top 20 highest anomaly scores:
     test_index  ...                                anomaly_description
948         948  ...  IBAN_MISMATCH_ANOMALY: IBAN changed from GB91K...
232         232  ...                                                NaN
244         244  ...  CHANNEL_ANOMALY: Payment made via CARD/MOBILE_...
571         571  ...                                                NaN
160         160  ...                                                NaN
536         536  ...                                                NaN
70           70  ...                                                NaN
55           55  ...                                                NaN
319         319  ...                                                NaN
634         634  ...                                                NaN
776         776  ...                                                NaN
852         852  ...                                                NaN
900         900  ...                                                NaN
664         664  ...                                                NaN
850         850  ...                                                NaN
873         873  ...                                                NaN
715         715  ...                                                NaN
819         819  ...                                                NaN
397         397  ...                                                NaN
354         354  ...                                                NaN

[20 rows x 6 columns]

✓ Results saved to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_scores.csv
✓ Summary saved to: /pfs/work9/workspace/scratch/ma_pkonz-thesis/ForestDiffusion/results/business_anomaly_detection/business_anomaly_summary.json

================================================================================
BUSINESS ANOMALY DETECTION EXPERIMENT COMPLETED!
================================================================================
ROC-AUC: 0.9995
Best F1: 0.3077
Normal correctly classified: 994/1003
Anomalies detected         : 2/2

Used Hyperparameters:
n_t: 100
duplicate_K: 20
diffusion_type: 'flow'
max_depth: 8
n_estimators: 150
eta: 0.3
dataset: Business Transaction Data
datset size (train/test): 4019/1005
== Job abgeschlossen ==

============================= JOB FEEDBACK =============================

NodeName=uc2n903
Job ID: 2229375
Cluster: uc3
User/Group: ma_pkonz/ma_ma
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 2
CPU Utilized: 00:27:19
CPU Efficiency: 88.88% of 00:30:44 core-walltime
Job Wall-clock time: 00:15:22
Memory Utilized: 3.26 GB
Memory Efficiency: 10.20% of 32.00 GB (32.00 GB/node)
